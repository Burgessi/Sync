<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.pro.sync.employee.dao.EmployeeDaoImpl">
	<!-- 사원 등록 -->
	<insert id="insertEmployee">
		INSERT INTO EMPLOYEE (
		EMP_ID,
		EMP_NAME,
		EMP_SSN,
		EMP_GENDER,
		RANK_ID,
		EMP_LEAD,
		TEAM_CODE,
		EMP_HIRE_DATE,
		AUTHORITY
		) VALUES ((SELECT
		'A' || LPAD(NVL(MAX(TO_NUMBER(SUBSTR(EMP_ID, 2))), 0)
		+ 1, 3, '0')
		FROM
		EMPLOYEE),#{emp_name},#{emp_ssn},
		#{emp_gender},#{rank_id},#{emp_lead},#{team_code}
		,CURRENT_DATE, #{authority})
	</insert>

	<!-- 사원 전체 조회 -->
	<select id="getAllEmployee" resultType="EmployeeVo">
		SELECT e.EMP_ID AS
		emp_id,
		e.EMP_NAME AS emp_name,
		e.EMP_EMAIL AS emp_email,
		t.TEAM_NAME AS
		team_name,
		r.RANK_NAME AS rank_name,
		TO_CHAR(e.EMP_HIRE_DATE,
		'YYYY-MM-DD') AS emp_hire_date,
		e.EMP_STATUS AS emp_status,
		d.DIVISION_NAME AS division_name,
		e.TEAM_CODE
		FROM EMPLOYEE e
		JOIN TEAM t ON
		t.TEAM_CODE =
		e.TEAM_CODE
		JOIN "RANK" r ON r.RANK_ID =e.RANK_ID
		JOIN
		DIVISION d ON
		t.UPSTAIRS_DIVISION_CODE =d.DIVISION_CODE
		ORDER BY 
			CASE 
           	 	WHEN e.EMP_STATUS = 'B' THEN 1
            	WHEN e.EMP_STATUS = 'A' THEN 2
            	WHEN e.EMP_STATUS = 'C' THEN 3
            	WHEN e.EMP_STATUS = 'D' THEN 4
            ELSE 5
       	 END,
		EMP_ID DESC
	</select>

	<!-- 사원 상세 조회 -->
	<select id="employeeSelectDetail" resultType="EmployeeVo">
		SELECT
		e.EMP_ID,
		e.EMP_NAME,
		d.DIVISION_NAME,
		t.TEAM_NAME,
		r.RANK_NAME,
		e.EMP_LEAD,
		e.EMP_EMAIL,
		e.EMP_STATUS,
		e.AUTHORITY,
		a.BANK_NAME,
		a.ACCOUNT_NUM,
		e.ADDR1,
		e.ADDR2,
		TO_CHAR(e.EMP_HIRE_DATE, 'YYYY-MM-DD') AS EMP_HIRE_DATE
		FROM
		EMPLOYEE e
		FULL OUTER JOIN TEAM t ON t.TEAM_CODE = e.TEAM_CODE
		FULL
		OUTER JOIN "RANK" r ON r.RANK_ID = e.RANK_ID
		FULL OUTER JOIN DIVISION d
		ON t.UPSTAIRS_DIVISION_CODE = d.DIVISION_CODE
		FULL OUTER JOIN ACCOUNT a
		ON a.EMP_ID = e.EMP_ID
		WHERE e.EMP_ID = #{emp_id}
	</select>


	<!-- 사원 수정 -->
	<update id="updateEmployee" parameterType="java.util.Map">
		UPDATE EMPLOYEE e
		<set>
			<if test="team_code != null and team_code != ''">
				TEAM_CODE = #{team_code},
			</if>
			<if test="rank_id != null and rank_id != ''">
				RANK_ID = #{rank_id},
			</if>
			<if test="authority != null and authority != ''">
				AUTHORITY = #{authority},
			</if>
			<if test="emp_lead != null and emp_lead != ''">
				EMP_LEAD = #{emp_lead},
			</if>
			<if test="emp_signature != null and emp_signature != ''">
               EMP_SIGNATURE = #{emp_signature},
            </if>
			
		</set>
		WHERE e.EMP_ID = #{emp_id}
	</update>

	<!-- 사원 삭제 -->
	<update id="deleteEmployee">
		UPDATE EMPLOYEE
		SET EMP_STATUS ='D'
		WHERE EMP_ID =#{emp_id}
	</update>


</mapper>
